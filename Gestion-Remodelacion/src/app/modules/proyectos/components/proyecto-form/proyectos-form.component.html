<div class="form-card mat-dialog-container">
  <div class="form-header">
    <h2 mat-dialog-title>{{ (data ? 'PROJECTS.EDIT_PROJECT' : 'PROJECTS.CREATE_PROJECT') | translate }}</h2>
  </div>

  <form [formGroup]="form" (ngSubmit)="onSubmit()">
    <mat-dialog-content class="mat-typography form-content">
      <div class="form-section">
        <h3>{{ 'PROJECTS.PROJECT_DETAILS' | translate }}</h3>
        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>{{ 'PROJECTS.PROJECT_NAME' | translate }}</mat-label>
            <input matInput formControlName="nombreProyecto" required />
            <mat-error *ngIf="form.get('nombreProyecto')?.hasError('required') && form.get('nombreProyecto')?.touched">
              {{ 'PROJECTS.PROJECT_NAME_REQUIRED' | translate }}
            </mat-error>
          </mat-form-field>
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>{{ 'PROJECTS.STATUS' | translate }}</mat-label>
            <mat-select formControlName="estado" required>
              <mat-option *ngFor="let estado of estadosProyecto" [value]="estado.backendValue">
                {{ estado.viewValue }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="form.get('estado')?.hasError('required') && form.get('estado')?.touched">
              {{ 'PROJECTS.STATUS_REQUIRED' | translate }}
            </mat-error>
          </mat-form-field>
        </div>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>{{ 'PROJECTS.PROPERTY_ADDRESS' | translate }}</mat-label>
          <input matInput formControlName="direccionPropiedad" required />
          <mat-error *ngIf="form.get('direccionPropiedad')?.hasError('required') && form.get('direccionPropiedad')?.touched">
            {{ 'PROJECTS.PROPERTY_ADDRESS_REQUIRED' | translate }}
          </mat-error>
        </mat-form-field>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>{{ 'PROJECTS.DESCRIPTION' | translate }}</mat-label>
          <textarea matInput formControlName="descripcion" rows="3"></textarea>
        </mat-form-field>
      </div>

      <div class="form-section">
        <h3>{{ 'PROJECTS.KEY_DATES' | translate }}</h3>
        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>{{ 'PROJECTS.START_DATE' | translate }}</mat-label>
            <input matInput [matDatepicker]="pickerInicio" formControlName="fechaInicio" required />
            <mat-datepicker-toggle matSuffix [for]="pickerInicio"></mat-datepicker-toggle>
            <mat-datepicker #pickerInicio></mat-datepicker>
            <mat-error *ngIf="form.get('fechaInicio')?.hasError('required') && form.get('fechaInicio')?.touched">
              {{ 'PROJECTS.START_DATE_REQUIRED' | translate }}
            </mat-error>
          </mat-form-field>
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>{{ 'PROJECTS.ESTIMATED_END_DATE' | translate }}</mat-label>
            <input matInput [matDatepicker]="pickerFinEstimada" formControlName="fechaFinEstimada" required />
            <mat-datepicker-toggle matSuffix [for]="pickerFinEstimada"></mat-datepicker-toggle>
            <mat-datepicker #pickerFinEstimada></mat-datepicker>
            <mat-error *ngIf="form.get('fechaFinEstimada')?.hasError('required') && form.get('fechaFinEstimada')?.touched">
              {{ 'PROJECTS.ESTIMATED_END_DATE_REQUIRED' | translate }}
            </mat-error>
          </mat-form-field>
        </div>
        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>{{ 'PROJECTS.ACTUAL_END_DATE' | translate }}</mat-label>
            <input matInput [matDatepicker]="pickerFinReal" formControlName="fechaFinalizacionReal" />
            <mat-datepicker-toggle matSuffix [for]="pickerFinReal"></mat-datepicker-toggle>
            <mat-datepicker #pickerFinReal></mat-datepicker>
          </mat-form-field>
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>{{ 'PROJECTS.LAST_PAYMENT_DATE' | translate }}</mat-label>
            <input matInput [matDatepicker]="pickerUltimoPago" formControlName="fechaUltimoPagoRecibido" />
            <mat-datepicker-toggle matSuffix [for]="pickerUltimoPago"></mat-datepicker-toggle>
            <mat-datepicker #pickerUltimoPago></mat-datepicker>
          </mat-form-field>
        </div>
      </div>

      <div class="form-section">
        <h3>{{ 'PROJECTS.FINANCIAL_DETAILS' | translate }}</h3>
        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>{{ 'PROJECTS.CONTRACT_AMOUNT' | translate }}</mat-label>
            <input matInput type="text" formControlName="montoContrato" appNumberFormat required min="0" />
            <mat-error *ngIf="form.get('montoContrato')?.hasError('required')">{{ 'PROJECTS.CONTRACT_AMOUNT_REQUIRED' | translate }}</mat-error>
            <mat-error *ngIf="form.get('montoContrato')?.hasError('min')">{{ 'PROJECTS.CONTRACT_AMOUNT_POSITIVE' | translate }}</mat-error>
          </mat-form-field>
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>{{ 'PROJECTS.AMOUNT_RECEIVED' | translate }}</mat-label>
            <input matInput type="text" formControlName="montoRecibido" appNumberFormat min="0" />
            <mat-error *ngIf="form.get('montoRecibido')?.hasError('min')">{{ 'PROJECTS.AMOUNT_RECEIVED_POSITIVE' | translate }}</mat-error>
          </mat-form-field>
        </div>
        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>{{ 'PROJECTS.MATERIALS_COST' | translate }}</mat-label>
            <input matInput type="text" formControlName="costoMaterialesConsolidado" appNumberFormat min="0" />
            <mat-error *ngIf="form.get('costoMaterialesConsolidado')?.hasError('min')">{{ 'PROJECTS.MATERIALS_COST_POSITIVE' | translate }}</mat-error>
          </mat-form-field>
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>{{ 'PROJECTS.OTHER_EXPENSES' | translate }}</mat-label>
            <input matInput type="text" formControlName="otrosGastosDirectosConsolidado" appNumberFormat min="0" />
            <mat-error *ngIf="form.get('otrosGastosDirectosConsolidado')?.hasError('min')">{{ 'PROJECTS.OTHER_EXPENSES_POSITIVE' | translate }}</mat-error>
          </mat-form-field>
        </div>
        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>{{ 'PROJECTS.LABOR_COST' | translate }}</mat-label>
            <input matInput type="number" formControlName="costoManoDeObra" readonly />
          </mat-form-field>
        </div>
      </div>

      <div class="form-section">
        <h3>{{ 'PROJECTS.PROGRESS_AND_NOTES' | translate }}</h3>
        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>{{ 'PROJECTS.PROGRESS' | translate }}</mat-label>
            <input matInput type="number" formControlName="progresoPorcentaje" min="0" max="100" />
            <mat-error *ngIf="form.get('progresoPorcentaje')?.hasError('min') || form.get('progresoPorcentaje')?.hasError('max')">
              {{ 'PROJECTS.PROGRESS_PERCENTAGE_RANGE' | translate }}
            </mat-error>
          </mat-form-field>
        </div>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>{{ 'PROJECTS.PROJECT_NOTES' | translate }}</mat-label>
          <textarea matInput formControlName="notasProyecto" rows="3"></textarea>
        </mat-form-field>
      </div>

      <div class="form-section">
        <h3>{{ 'PROJECTS.RELATIONSHIPS' | translate }}</h3>
        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>{{ 'PROJECTS.CLIENT' | translate }}</mat-label>
            <mat-select formControlName="idCliente" required>
              <mat-option *ngFor="let cliente of clientes$ | async" [value]="cliente.id">
                {{ cliente.nombre }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="form.get('idCliente')?.hasError('required') && form.get('idCliente')?.touched">
              {{ 'PROJECTS.CLIENT_REQUIRED' | translate }}
            </mat-error>
          </mat-form-field>
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>{{ 'PROJECTS.RESPONSIBLE_EMPLOYEE' | translate }}</mat-label>
            <mat-select formControlName="idEmpleadoResponsable">
              <mat-option [value]="null">{{ 'PROJECTS.SELECT_OPTION' | translate }}</mat-option>
              <mat-option *ngFor="let empleado of empleados$ | async" [value]="empleado.id">
                {{ empleado.nombre }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>
    </mat-dialog-content>

    <mat-dialog-actions align="end" class="form-actions">
      <button mat-button type="button" (click)="onCancel()">{{ 'GLOBAL.CANCEL' | translate }}</button>
      <button mat-raised-button color="primary" type="submit" [disabled]="form.invalid">
        {{ (data ? 'GLOBAL.UPDATE' : 'GLOBAL.SAVE') | translate }}
      </button>
    </mat-dialog-actions>
  </form>
</div>